<!-- ===== NAVBAR SUPERIOR ===== -->
<nav
  class="navbar"
  style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
  "
>
  <div class="left" style="display: flex; align-items: center">
    <img
      src="assets/user-profile.png"
      alt="Perfil"
      routerLink="/dashteste"
      class="profile-img"
      style="width: 85px; height: 85px; border-radius: 50%; cursor: pointer"
    />
    <div class="greeting" style="color: white">
      <div style="font-size: 20px; font-weight: bold">
        Olá, {{ usuarioService.nomeUsuario || "..." }}
      </div>
      <small style="font-size: 14px">{{ dataHoje }}</small>
    </div>
  </div>

  <div
    class="right"
    style="
      display: flex;
      align-items: flex-end;
      gap: 0.5rem;
      padding-bottom: 0.25px;
      margin-top: 20px;
    "
  >
    <!-- ===== NOTIFICAÇÕES ===== -->
    <div
      class="notificacao-wrapper"
      (mouseenter)="abrirNotificacao()"
      (mouseleave)="fecharNotificacao()"
      style="margin-right: 0.625rem"
    >
      <img
        src="assets/notificacao.png"
        alt="Notificações"
        class="notificacao"
        style="width: 2.25rem; cursor: pointer; transform: translateY(2px)"
      />

      <div class="notificacao-popup" *ngIf="mostrarNotificacoes">
        <div *ngFor="let n of notificacoes" class="notificacao-card">
          <div class="notificacao-imagem">
            <img
              [src]="n.imagemUrl"
              alt="Imagem"
              style="width: 100%; height: 100%"
            />
          </div>
          <div class="notificacao-conteudo">
            <strong>{{ n.titulo }}</strong>
            <small>{{ n.descricao }}</small>
          </div>
          <div
            *ngIf="usuarioService.usuarioEhAdmin()"
            style="
              display: flex;
              align-items: center;
              gap: 0.3rem;
              margin-left: auto;
            "
          >
            <span
              class="editar-notificacao"
              title="Editar notificação"
              style="cursor: pointer; font-size: 18px"
              (click)="editarNotificacao(n)"
              >✎</span
            >
            <span
              class="apagar-notificacao"
              title="Remover notificação"
              style="cursor: pointer; font-size: 18px"
              (click)="confirmarRemocao(n)"
              >✕</span
            >
          </div>
        </div>

        <div
          class="nova-notificacao"
          *ngIf="usuarioService.usuarioEhAdmin()"
          (click)="abrirFormularioNotificacao()"
        >
          + Nova notificação
        </div>
      </div>

      <!-- ===== FORMULÁRIO DE NOTIFICAÇÃO ===== -->
      <div
        class="formulario-modal"
        *ngIf="mostrarFormulario"
        style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 20px;
          border-radius: 12px;
          z-index: 999;
          width: 400px;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        "
      >
        <h3 style="color: black; margin-top: 0">Nova Notificação</h3>

        <input
          type="text"
          [(ngModel)]="nova.titulo"
          class="form-control"
          placeholder="Título da notificação"
          style="width: 100%"
        />
        <textarea
          [(ngModel)]="nova.descricao"
          class="form-control"
          placeholder="Descrição da notificação"
          style="width: 100%; resize: none"
          rows="3"
        ></textarea>

        <input
          style="color: black"
          type="file"
          (change)="onFileChange($event)"
        />

        <div class="botoes-container">
          <button class="cancelar" (click)="cancelarFormulario()">
            Cancelar
          </button>
          <button
            class="salvar"
            (click)="salvarNotificacao()"
            [disabled]="
              !nova.titulo.trim() || !nova.descricao.trim() || !nova.imagemUrl
            "
          >
            Salvar
          </button>
        </div>
      </div>
    </div>

    <!-- ===== MENU DROPDOWN ===== -->
    <div
      class="dropdown"
      (mouseenter)="abrirMenu()"
      (mouseleave)="fecharMenu()"
    >
      <div class="dropdown-toggle">☰</div>
      <ul class="dropdown-menu" *ngIf="menuAberto">
        <li><a routerLink="/menu">Perfil</a></li>
        <li><a routerLink="/galeria">Galeria</a></li>
        <li><a routerLink="/produtos">Produtos</a></li>
        <li><a routerLink="/agendamentos">Agendamentos</a></li>
      </ul>
    </div>
  </div>
</nav>

<!-- ===== CONTAINER DE SERVIÇOS E HORÁRIOS ===== -->
<div class="agendamento-container">
  <!-- ===== SERVIÇOS ===== -->
  <div class="servicos-box">
    <h3>Selecione os Serviços:</h3>
    <div class="servicos-lista">
      <div *ngFor="let servico of servicos" class="servico-item">
        <label>
          <input
            type="checkbox"
            [value]="servico.id"
            (change)="toggleServico(servico.id!, $event)"
            [checked]="servicosSelecionados.includes(servico.id!)"
          />
          {{ servico.nome }}
        </label>
        <span class="preco-servico"
          >R$ {{ servico.preco | number : "1.2-2" }}</span
        >
      </div>
    </div>
  </div>

  <!-- ===== HORÁRIOS E RESUMO ===== -->
  <div class="horarios-box">
    <!-- ===== HORÁRIOS DISPONÍVEIS ===== -->
    <div class="horarios-disponiveis">
      <h2>Horarios Disponíveis - Felipe</h2>

      <!-- AÇÕES ADMIN -->
      <div *ngIf="usuarioService.usuarioEhAdmin()" class="acoes-admin">
        <button title="Criar horário" (click)="abrirFormularioCriarHorario()">
          🕒➕
        </button>
        <button title="Bloquear dia" (click)="bloquearDiaSelecionado()">
          🚫📅
        </button>
      </div>

      <!-- SELEÇÃO DE DIA -->
      <div class="dias-wrapper">
        <button
          *ngFor="let d of diasSemana"
          [class.ativo]="diaSelecionado === d.value"
          (click)="selecionarDia(d.value)"
        >
          {{ d.label }}
        </button>
      </div>

      <!-- PERÍODO MANHÃ -->
      <div class="periodo">
        <h4>Manhã</h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosManha"
            [class.bloqueado]="h.bloqueado"
            class="horario-box"
          >
            {{ h.horario }}

            <span *ngIf="usuarioService.usuarioEhAdmin()" class="acoes-horario">
              <button
                title="Editar horário"
                (click)="editarHorario(h)"
                class="btn-icon"
              >
                ✎
              </button>
              <button
                title="Remover horário"
                (click)="removerHorario(h)"
                class="btn-icon"
              >
                🗑️
              </button>
              <button
                title="Bloquear horário"
                (click)="bloquearHorario(h)"
                class="btn-icon"
              >
                🚫
              </button>
            </span>
          </div>
        </div>
      </div>

      <!-- PERÍODO TARDE -->
      <div class="periodo">
        <h4>Tarde</h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosTarde"
            [class.bloqueado]="h.bloqueado"
            class="horario-box"
          >
            {{ h.horario }}
            <span *ngIf="usuarioService.usuarioEhAdmin()" class="acoes-horario">
              <button
                title="Editar horário"
                (click)="editarHorario(h)"
                class="btn-icon"
              >
                ✎
              </button>
              <button
                title="Remover horário"
                (click)="removerHorario(h)"
                class="btn-icon"
              >
                🗑️
              </button>
              <button
                title="Bloquear horário"
                (click)="bloquearHorario(h)"
                class="btn-icon"
              >
                🚫
              </button>
            </span>
          </div>
        </div>
      </div>

      <!-- PERÍODO NOITE -->
      <div class="periodo">
        <h4>Noite</h4>
        <div class="horarios">
          <div
            *ngFor="let h of horariosNoite"
            [class.bloqueado]="h.bloqueado"
            class="horario-box"
          >
            {{ h.horario }}
            <span *ngIf="usuarioService.usuarioEhAdmin()" class="acoes-horario">
              <button
                title="Editar horário"
                (click)="editarHorario(h)"
                class="btn-icon"
              >
                ✎
              </button>
              <button
                title="Remover horário"
                (click)="removerHorario(h)"
                class="btn-icon"
              >
                🗑️
              </button>
              <button
                title="Bloquear horário"
                (click)="bloquearHorario(h)"
                class="btn-icon"
              >
                🚫
              </button>
            </span>
          </div>
        </div>
      </div>
    </div>

    <!-- ===== RESUMO DO AGENDAMENTO ===== -->
    <div class="resumo-agendamento">
      <div class="informacoes-box">
        <h3>Resumo do Agendamento</h3>

        <div class="resumo-item">
          <strong>Barbeiro Selecionado:</strong>
          <span>{{ barbeiroSelecionado?.nome || "Nenhum selecionado" }}</span>
        </div>

        <div class="resumo-item">
          <label for="cupom"><strong>Aplicar Cupom:</strong></label>
          <select
            id="cupom"
            [(ngModel)]="cupomSelecionadoId"
            (change)="onCupomChange()"
          >
            <option [value]="''">Nenhum</option>
            <option *ngFor="let c of cuponsDisponiveis" [value]="c.id">
              {{ c.nome }} - {{ c.desconto }}%
            </option>
          </select>
        </div>

        <div class="resumo-item">
          <strong>Valor Total:</strong>
          R$ {{ valorTotal | number : "1.2-2" }}
        </div>

        <div class="resumo-item">
          <strong>Desconto:</strong>
          <span *ngIf="descontoAplicado > 0"
            >- R$ {{ descontoAplicado | number : "1.2-2" }}</span
          >
          <span *ngIf="descontoAplicado === 0">R$ 0.00</span>
        </div>

        <div class="resumo-item">
          <strong>Valor Final:</strong>
          <span style="color: #f46d25; font-weight: bold"
            >R$ {{ valorFinal | number : "1.2-2" }}</span
          >
        </div>

        <button class="confirmar-btn" (click)="confirmarAgendamento()">
          Confirmar Agendamento
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===== BARRA INFERIOR MOBILE ===== -->
<nav class="bottom-nav">
  <a routerLink="/dashteste" class="nav-item">
    <img src="assets/inicio.png" alt="Início" width="38" height="32" />
    <span>Início</span>
  </a>
  <a routerLink="/galeria" class="nav-item">
    <img src="assets/galeria-ativa.png" alt="Galeria" width="34" height="33" />
    <span style="color: #f46d25; font-weight: bold">Galeria</span>
  </a>
  <a routerLink="/agendamentos" class="nav-item">
    <img
      src="assets/agendamento.png"
      alt="Agendamentos"
      width="34"
      height="34"
    />
    <span>Agendamentos</span>
  </a>
  <a routerLink="/produtos" class="nav-item">
    <img src="assets/produto.png" alt="Produtos" width="30" height="30" />
    <span>Produtos</span>
  </a>
  <a routerLink="/menu" class="nav-item">
    <img src="assets/user-profile.png" alt="Menu" width="40" height="40" />
    <span>Menu</span>
  </a>
</nav>
