<!-- NAVBAR SUPERIOR -->
<nav
    class="navbar"
    style="
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 10px;
  ">
    <div class="left" style="display: flex; align-items: center">
        <img
            src="assets/user-profile.png"
            alt="Perfil"
            routerLink="/dashteste"
            class="profile-img"
            style="width: 85px; height: 85px; border-radius: 50%; cursor: pointer" />
        <div class="greeting" style="color: white">
            <div style="font-size: 20px; font-weight: bold">
                Olá, {{ usuarioService.nomeUsuario || "..." }}
            </div>
            <small style="font-size: 14px">{{ dataHoje }}</small>
        </div>
    </div>

    <div
        class="right"
        style="
      display: flex;
      align-items: flex-end;
      gap: 0.5rem;
      padding-bottom: 0.25px;
      margin-top: 20px;
    ">
        <!-- Ícone Notificação com pop-up -->
        <div
            class="notificacao-wrapper"
            (mouseenter)="abrirNotificacao()"
            (mouseleave)="fecharNotificacao()"
            style="margin-right: 0.625rem">
            <img
                src="assets/notificacao.png"
                alt="Notificações"
                class="notificacao"
                style="width: 2.25rem; cursor: pointer; transform: translateY(2px)" />

            <!-- Pop-up dinâmico -->
            <div class="notificacao-popup" *ngIf="mostrarNotificacoes">
                <div *ngFor="let n of notificacoes" class="notificacao-card">
                    <div class="notificacao-imagem">
                        <img
                            [src]="n.imagemUrl"
                            alt="Imagem"
                            style="width: 100%; height: 100%" />
                    </div>
                    <div class="notificacao-conteudo">
                        <strong>{{ n.titulo }}</strong>
                        <small>{{ n.descricao }}</small>
                    </div>
                    <div
                        *ngIf="usuarioService.usuarioEhAdmin()"
                        style="
              display: flex;
              align-items: center;
              gap: 0.3rem;
              margin-left: auto;
            ">
                        <span
                            class="editar-notificacao"
                            title="Editar notificação"
                            style="cursor: pointer; font-size: 18px"
                            (click)="editarNotificacao(n)">✎</span>
                        <span
                            class="apagar-notificacao"
                            title="Remover notificação"
                            style="cursor: pointer; font-size: 18px"
                            (click)="confirmarRemocao(n)">✕</span>
                    </div>
                </div>

                <div
                    class="nova-notificacao"
                    *ngIf="usuarioService.usuarioEhAdmin()"
                    (click)="abrirFormularioNotificacao()">
                    + Nova notificação
                </div>
            </div>

            <!-- Formulário de criação (modal) -->
            <div
                class="formulario-modal"
                *ngIf="mostrarFormulario"
                style="
          position: fixed;
          top: 50%;
          left: 50%;
          transform: translate(-50%, -50%);
          background: white;
          padding: 20px;
          border-radius: 12px;
          z-index: 999;
          width: 400px;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
        ">
                <h3 style="color: black; margin-top: 0">Nova Notificação</h3>

                <input
                    type="text"
                    [(ngModel)]="nova.titulo"
                    class="form-control"
                    placeholder="Título da notificação"
                    style="width: 100%" />
                <textarea
                    [(ngModel)]="nova.descricao"
                    class="form-control"
                    placeholder="Descrição da notificação"
                    style="width: 100%; resize: none"
                    rows="3"></textarea>

                <input
                    style="color: black"
                    type="file"
                    (change)="onFileChange($event)" />

                <div class="botoes-container">
                    <button class="cancelar" (click)="cancelarFormulario()">
                        Cancelar
                    </button>
                    <button
                        class="salvar"
                        (click)="salvarNotificacao()"
                        [disabled]="
              !nova.titulo.trim() || !nova.descricao.trim() || !nova.imagemUrl
            ">
                        Salvar
                    </button>
                </div>
            </div>
        </div>

        <!-- Botão de menu -->
        <div
            class="dropdown"
            (mouseenter)="abrirMenu()"
            (mouseleave)="fecharMenu()">
            <div class="dropdown-toggle">☰</div>
            <ul class="dropdown-menu" *ngIf="menuAberto">
                <li><a routerLink="/menu">Perfil</a></li>
                <li><a routerLink="/galeria">Galeria</a></li>
                <li><a routerLink="/produtos">Produtos</a></li>
                <li><a routerLink="/agendamentos">Agendamentos</a></li>
            </ul>
        </div>
    </div>
</nav>

<!-- CONTAINER DE SERVIÇOS E HORÁRIOS -->
<div class="agendamento-container">
    <!-- LADO ESQUERDO: SERVIÇOS -->
    <div class="servicos-box">
        <h3>Selecione os Serviços:</h3>
        <div class="servicos-lista">
            <div *ngFor="let servico of servicos" class="servico-item">
                <label>
                    <input
                        type="checkbox"
                        [value]="servico.id"
                        (change)="toggleServico(servico.id!, $event)"
                        [checked]="servicosSelecionados.includes(servico.id!)" />
                    {{ servico.nome }}
                </label>
                <span class="preco-servico">R$ {{ servico.preco | number:
                    '1.2-2' }}</span>
            </div>
        </div>
    </div>

    <!-- LADO DIREITO: HORÁRIOS -->
    <div class="horarios-box">
        <h3>Horários Disponíveis:</h3>

        <!-- FORMULÁRIO DE HORÁRIO -->
        <form (ngSubmit)="salvarHorario()"
            style="margin-bottom: 1rem; display: flex; gap: 0.5rem; flex-wrap: wrap;">
            <input
                type="time"
                [(ngModel)]="novoHorario.hora"
                name="hora"
                class="form-control"
                required
                style="padding: 5px; font-size: 14px;" />
            <button type="submit" class="btn-salvar">
                {{ editandoHorario ? 'Atualizar' : 'Adicionar' }}
            </button>
            <button type="button" *ngIf="editandoHorario"
                (click)="resetarFormularioHorario()" class="btn-cancelar">
                Cancelar
            </button>
        </form>

        <!-- LISTA DE HORÁRIOS -->
        <div class="horarios-lista">
            <div *ngIf="horarios.length === 0" style="color: gray">Nenhum
                horário cadastrado.</div>

            <ul *ngIf="horarios.length > 0"
                style="list-style: none; padding-left: 0">
                <li *ngFor="let h of horarios" style="margin-bottom: 0.5rem">
                    <strong>{{ h.hora }}</strong> –
                    <span [style.color]="h.bloqueado ? 'red' : 'green'">
                        {{ h.bloqueado ? 'Bloqueado' : 'Disponível' }}
                    </span>

                    <!-- Botões -->
                    <div
                        style="display: inline-flex; gap: 6px; margin-left: 10px">
                        <button (click)="editarHorario(h)"
                            class="btn-editar">Editar</button>
                        <button (click)="deletarHorario(h.id!)"
                            class="btn-remover">Remover</button>
                        <button (click)="alternarBloqueioHorario(h)"
                            class="btn-bloquear">
                            {{ h.bloqueado ? 'Desbloquear' : 'Bloquear' }}
                        </button>
                    </div>
                </li>
            </ul>
        </div>
    </div>
</div> <!-- Fecha a agendamento-container aqui! -->

<!-- ✅ RESUMO DO AGENDAMENTO - Fora da .agendamento-container -->
<div class="resumo-agendamento">
    <div class="informacoes-box">
        <h3>Resumo do Agendamento</h3>

        <!-- Nome do barbeiro (somente leitura) -->
        <div class="resumo-item">
            <strong>Barbeiro Selecionado:</strong>
            <span>{{ barbeiroSelecionado?.nome || 'Nenhum selecionado' }}</span>
        </div>

        <!-- Cupom Dropdown -->
        <div class="resumo-item">
            <label for="cupom"><strong>Aplicar Cupom:</strong></label>
            <select id="cupom" [(ngModel)]="cupomSelecionadoId"
                (change)="onCupomChange()">
                <option [value]="''">Nenhum</option>
                <option *ngFor="let c of cuponsDisponiveis" [value]="c.id">
                    {{ c.nome }} - {{ c.desconto }}%
                </option>
            </select>
        </div>

        <!-- Valores -->
        <div class="resumo-item">
            <strong>Valor Total:</strong> R$ {{ valorTotal | number: '1.2-2' }}
        </div>

        <div class="resumo-item">
            <strong>Desconto:</strong>
            <span *ngIf="descontoAplicado > 0">- R$ {{ descontoAplicado |
                number: '1.2-2' }}</span>
            <span *ngIf="descontoAplicado === 0">R$ 0.00</span>
        </div>

        <div class="resumo-item">
            <strong>Valor Final:</strong>
            <span style="color: #f46d25; font-weight: bold">
                R$ {{ valorFinal | number: '1.2-2' }}
            </span>
        </div>

        <!-- Botão de confirmação -->
        <button class="confirmar-btn" (click)="confirmarAgendamento()">Confirmar
            Agendamento</button>
    </div>
</div>

<!-- BARRA INFERIOR MOBILE -->
<nav class="bottom-nav">
    <a routerLink="/dashteste" class="nav-item">
        <img src="assets/inicio.png" alt="Início" width="38px"
            height="32px" />
        <span>Início</span>
    </a>
    <a routerLink="/galeria" class="nav-item">
        <img
            src="assets/galeria-ativa.png"
            alt="Galeria"
            width="34px"
            height="33px" />
        <span style="color: #f46d25; font-weight: bold">Galeria</span>
    </a>
    <a routerLink="/agendamentos" class="nav-item">
        <img
            src="assets/agendamento.png"
            alt="Agendamentos"
            width="34px"
            height="34px" />
        <span>Agendamentos</span>
    </a>
    <a routerLink="/produtos" class="nav-item">
        <img src="assets/produto.png" alt="Produtos" width="30px"
            height="30px" />
        <span>Produtos</span>
    </a>
    <a routerLink="/menu" class="nav-item">
        <img src="assets/user-profile.png" alt="Menu" width="40px"
            height="40px" />
        <span>Menu</span>
    </a>
</nav>
